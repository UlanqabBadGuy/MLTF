# The Group Project - Machine Learning in Trading and Finance
___
Topic: Prediction of Loan Default Risk Based on Machine Learning
___
## Inroduction
data file: data/Loan_Default/Loan_Default.csvï¼ˆhttps://www.kaggle.com/datasets/yasserh/loan-default-dataset/dataï¼‰

## Methodology
### Model selection
åœ¨â€œ**è´·æ¬¾è¿çº¦é£é™©é¢„æµ‹ï¼ˆPrediction of Loan Default Riskï¼‰**â€è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬é¢å¯¹çš„æ˜¯ä¸€ä¸ª**ç»“æ„åŒ–è¡¨æ ¼æ•°æ®ä¸Šçš„äºŒåˆ†ç±»é—®é¢˜**ï¼ˆæ˜¯å¦è¿çº¦ï¼š0 or 1ï¼‰ï¼Œç›®æ ‡æ˜¯**ç²¾å‡†é¢„æµ‹é«˜é£é™©å®¢æˆ·**ã€‚è¿™ç±»é—®é¢˜æ˜¯é‡‘èé£æ§ä¸­çš„ç»å…¸åœºæ™¯ã€‚

---

#### âœ… **æ¨èçš„æ¨¡å‹**

ä»¥ä¸‹æ˜¯ä¸šç•Œã€æ¯”èµ›å’Œç”Ÿäº§ç¯å¢ƒä¸­éƒ½è¡¨ç°ä¼˜ç§€ã€å¸¸ç”¨çš„æ¨¡å‹ï¼š

| æ¨¡å‹åç§°        | ç‰¹ç‚¹                                              | æ˜¯å¦æ¨è |
|-----------------|---------------------------------------------------|----------|
| **LightGBM**     | å¾®è½¯æå‡ºçš„ GBDT ä¼˜åŒ–ç‰ˆï¼Œé€Ÿåº¦å¿«ã€æ€§èƒ½å¼ºã€é€‚åˆå¤§æ•°æ® | â­â­â­â­â­ æ¨è |
| **XGBoost**      | æœ€çŸ¥åçš„ GBDT å®ç°ï¼ŒKaggle æ¯”èµ›å¸¸èƒœå°†å†›           | â­â­â­â­     |
| **CatBoost**     | Yandex æå‡ºçš„ï¼Œå¤©ç„¶æ”¯æŒç±»åˆ«å˜é‡                   | â­â­â­â­     |
| **Random Forest**| å¤šä¸ªå†³ç­–æ ‘çš„é›†åˆï¼Œç¨³å®šï¼ŒæŠ—è¿‡æ‹Ÿåˆ                  | â­â­â­      |
| **Logistic Regression** | åŸºçº¿æ¨¡å‹ï¼Œç»“æœå¯è§£é‡Šæ€§å¼ºï¼ˆé‡‘èé¢†åŸŸå¸¸ç”¨ï¼‰    | â­â­â­      |
| **MLPï¼ˆå¤šå±‚æ„ŸçŸ¥æœºï¼‰**   | æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œéœ€å¤§é‡è°ƒå‚ï¼Œé€‚åˆå¤æ‚éçº¿æ€§     | â­â­       |
| **SVM**          | éå¸¸å¼ºçš„åˆ†ç±»å™¨ï¼Œä½†åœ¨å¤§æ•°æ®ä¸Šé€Ÿåº¦æ…¢               | â­        |

---

#### ğŸ§  **æ¨¡å‹é€‰æ‹©å»ºè®®**

1. **å¼ºçƒˆå»ºè®®ä½œä¸ºä¸»åŠ›æ¨¡å‹ï¼šLightGBM**
   - é«˜æ•ˆæ”¯æŒç¼ºå¤±å€¼ã€ç±»åˆ«å˜é‡ï¼ˆæ”¯æŒ `categorical_feature` å‚æ•°ï¼‰
   - è‡ªåŠ¨ç‰¹å¾é€‰æ‹©
   - è®­ç»ƒå¿«ï¼Œé¢„æµ‹ä¹Ÿå¿«
   - å¯ä»¥å¤„ç†ä¸å¹³è¡¡æ•°æ®

    ```python
    from lightgbm import LGBMClassifier
    
    model = LGBMClassifier(random_state=42)
    model.fit(X_train, y_train)
    ```

---

2. **XGBoost**
- å¦‚æœä½ å¸Œæœ›å¯¹ç»“æœè¿›è¡Œè§£é‡Šã€è°ƒå‚ç»†è‡´ï¼ŒXGBoost ä¹Ÿå¾ˆä¼˜ç§€
    ```python
    from xgboost import XGBClassifier
    
    model = XGBClassifier(random_state=42)
    model.fit(X_train, y_train)
    ```
---

3. **Logistic Regression**
- è‹¥ä½ å¯¹å¯è§£é‡Šæ€§æœ‰å¼ºè¦æ±‚ï¼ˆæ¯”å¦‚é“¶è¡Œé£æ§éœ€è¦â€œä¸ºä»€ä¹ˆå®¢æˆ·è¢«æ‹’è´·â€ï¼‰ å¯ä»¥è¾“å‡ºç³»æ•°ã€è¿›è¡Œæ¦‚ç‡åˆ¤æ–­
    ```python
    from sklearn.linear_model import LogisticRegression
    
    model = LogisticRegression()
    model.fit(X_train, y_train)
    ```
---

#### âš ï¸ æ³¨æ„äº‹é¡¹

æ•°æ®ä¸å¹³è¡¡é—®é¢˜ï¼ˆè¿çº¦å¾€å¾€æ˜¯å°‘æ•°ï¼‰
- å¦‚æœä½ çš„æ ‡ç­¾ä¸­ `è¿çº¦ï¼ˆStatus=1ï¼‰` å æ¯”å¾ˆå°‘ï¼š
    - å¯èƒ½è¦ä½¿ç”¨ `class_weight='balanced'` å‚æ•°
    - æˆ–è¿›è¡Œ**ä¸Šé‡‡æ · / ä¸‹é‡‡æ ·**
    - æˆ–ç”¨ `SMOTE`ï¼ˆåˆæˆå°‘æ•°æ ·æœ¬ï¼‰

---

#### ğŸ“Š æ¨¡å‹è¯„ä¼°å»ºè®®

ä»…ä»…çœ‹ `accuracy` å¹¶ä¸å¤Ÿï¼Œä½ è¿˜åº”è¯¥å…³æ³¨ï¼š

| æŒ‡æ ‡          | å«ä¹‰                                     |
|---------------|------------------------------------------|
| **AUC-ROC**   | è¡¡é‡æ¨¡å‹è¯†åˆ«æ­£è´Ÿæ ·æœ¬èƒ½åŠ›                 |
| **Precision** | ç²¾ç¡®ç‡ï¼Œé¢„æµ‹ä¸ºè¿çº¦ä¸­çœŸæ­£è¿çº¦çš„æ¯”ä¾‹       |
| **Recall**    | å¬å›ç‡ï¼Œæ‰€æœ‰è¿çº¦ä¸­è¢«æ¨¡å‹è¯†åˆ«çš„æ¯”ä¾‹       |
| **F1-score**  | Precision å’Œ Recall çš„è°ƒå’Œå¹³å‡           |
| **Confusion Matrix** | çœŸé˜³ã€å‡é˜³ã€çœŸé˜´ã€å‡é˜´çš„å…·ä½“æ•°é‡  |

---

####  ğŸ§ª æ¨¡å‹å¯¹æ¯”å»ºè®®ï¼š

å¯ä»¥ç»Ÿä¸€æ¡†æ¶æ¥è·‘å¤šä¸ªæ¨¡å‹å¯¹æ¯”ï¼ˆæ¯”å¦‚ç”¨ `sklearn` æˆ– `PyCaret`ã€`MLFlow`ï¼‰

---

####  ğŸ¯ æ€»ç»“ï¼šå»ºè®®ä½¿ç”¨è·¯å¾„

| ä¼˜å…ˆé¡ºåº | æ¨¡å‹            | é€‚ç”¨åœºæ™¯                 |
|----------|------------------|--------------------------|
| 1        | LightGBM         | é»˜è®¤é¦–é€‰ï¼Œæ€§èƒ½+é€Ÿåº¦å…¼é¡¾ |
| 2        | XGBoost          | é«˜å¯æ§æ€§ã€æ¯”èµ›å¸¸ç”¨       |
| 3        | CatBoost         | ç±»åˆ«å˜é‡å¤šæ—¶å¾ˆæœ‰ä¼˜åŠ¿     |
| 4        | LogisticRegression | éœ€è¦å¼ºè§£é‡Šæ€§æ—¶ä½¿ç”¨     |

---
#### Problems
éå¸¸å¥½ï¼Œä½ ç»™å‡ºçš„è¿™ä¸‰åˆ—ï¼š

1. `rate_of_interest`ï¼ˆè´·æ¬¾åˆ©ç‡ï¼‰  
2. `Interest_rate_spread`ï¼ˆè´·æ¬¾åˆ©ç‡ä¸åŸºå‡†åˆ©ç‡ä¹‹é—´çš„å·®é¢ï¼‰  
3. `Upfront_charges`ï¼ˆè´·æ¬¾å‰æœŸè´¹ç”¨ï¼‰

å’Œç›®æ ‡å˜é‡**é«˜åº¦ç›¸å…³**ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ä»ä¸¤ä¸ªå…³é”®è§’åº¦åˆ¤æ–­æ€ä¹ˆå¤„ç†å®ƒä»¬ï¼š

---

ğŸ” ä¸€ã€è¿™äº›å˜é‡æ˜¯å¦å±äºä¿¡æ¯æ³„éœ²ï¼Ÿ

ä½ éœ€è¦å…ˆåˆ¤æ–­ï¼š**åœ¨é¢„æµ‹ç›®æ ‡æ—¶ï¼ˆä¾‹å¦‚ï¼šè´·æ¬¾æ˜¯å¦è¿çº¦ï¼‰ï¼Œè¿™äº›å˜é‡æ˜¯å¦æ˜¯â€œæå‰å¯çŸ¥â€çš„ï¼Ÿ**

| å˜é‡å | æ˜¯å¦åœ¨æ”¾è´·å‰å·²çŸ¥ | æ˜¯å¦å¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ² |
|--------|------------------|----------------------|
| `rate_of_interest` | âœ… é€šå¸¸å®¡æ‰¹æ—¶å°±å®šäº† | âŒ ä¸æ³„éœ² |
| `Interest_rate_spread` | âœ… å¯ç”±åˆ©ç‡ - åŸºå‡†åˆ©ç‡è®¡ç®— | âŒ ä¸æ³„éœ² |
| `Upfront_charges` | âœ… åˆåŒç­¾è®¢æ—¶å°±ç¡®å®š | âŒ ä¸æ³„éœ² |

ğŸ‘‰ **ç»“è®º**ï¼šè¿™ä¸‰ä¸ªå˜é‡ä¸æ˜¯â€œäº‹åå˜é‡â€ï¼Œå±äºå¯åœ¨é¢„æµ‹æ—¶ä½¿ç”¨çš„â€œçœŸå®ç‰¹å¾â€ï¼Œ**æ²¡æœ‰ä¿¡æ¯æ³„éœ²é£é™©**ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚

---

ğŸ§  äºŒã€å®ƒä»¬ä¸ºä»€ä¹ˆé«˜åº¦ç›¸å…³ï¼Ÿ

è¿™ä¸‰åˆ—å…¶å®æ˜¯**é‡‘èå±æ€§é«˜åº¦è€¦åˆçš„ä½“ç°**ï¼Œå®ƒä»¬å½¼æ­¤ä¹Ÿå¾ˆå¯èƒ½é«˜åº¦ç›¸å…³ï¼ˆæ¯”å¦‚åˆ©ç‡è¶Šé«˜ï¼Œspread é€šå¸¸ä¹Ÿå¤§ï¼Œupfront è´¹ç”¨ä¹Ÿå¯èƒ½å¤šï¼‰ï¼š

- `Interest_rate_spread = rate_of_interest - åŸºå‡†åˆ©ç‡`ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªå¼ºç›¸å…³æ˜¯å¿…ç„¶çš„ã€‚
- `Upfront_charges` å’Œåˆ©ç‡ä¹‹é—´åœ¨å¾ˆå¤šé‡‘èäº§å“ä¸­ä¹Ÿæœ‰ååŒè®¾è®¡ï¼Œæ¯”å¦‚ä½åˆ©ç‡çš„è´·æ¬¾å¯èƒ½ä¼šæ”¶å–æ›´é«˜çš„å‰æœŸè´¹ç”¨ã€‚

### ğŸ¤¯ æ½œåœ¨é—®é¢˜ï¼šå¤šé‡å…±çº¿æ€§
è™½ç„¶è¿™äº›ç‰¹å¾å¯¹æ¨¡å‹å¯èƒ½æœ‰å¸®åŠ©ï¼Œä½†**é«˜åº¦çº¿æ€§ç›¸å…³çš„å¤šä¸ªå˜é‡ä¼šå½±å“è§£é‡Šæ€§æ¨¡å‹ï¼ˆå¦‚çº¿æ€§å›å½’ã€é€»è¾‘å›å½’ï¼‰**ã€‚

---

âœ… å»ºè®®å¤„ç†æ–¹å¼

| ç›®æ ‡ | å»ºè®® |
|------|------|
| æé«˜æ¨¡å‹å‡†ç¡®ç‡ï¼ˆæ¯”å¦‚ XGBoostã€éšæœºæ£®æ—ã€ç¥ç»ç½‘ç»œï¼‰ | âœ… **ä¿ç•™æ‰€æœ‰è¿™ä¸‰åˆ—**ï¼Œè®©æ¨¡å‹è‡ªè¡Œåˆ¤æ–­æƒé‡ |
| æ„å»ºé€»è¾‘å›å½’ç­‰éœ€è¦è‰¯å¥½è§£é‡Šæ€§çš„æ¨¡å‹ | âš ï¸ å¯è€ƒè™‘åªä¿ç•™ `rate_of_interest`ï¼Œæˆ–è€…è¿›è¡Œä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰é™ç»´ |
| æ‹…å¿ƒå…±çº¿æ€§ | âš ï¸ å¯ä»¥åˆ æ‰ä¸€ä¸ªï¼Œæ¯”å¦‚ `Interest_rate_spread`ï¼ˆå› å®ƒå¯ç”±å‰è€…æ¨å¾—ï¼‰ |

---

## ğŸ’¡ Bonusï¼šç‰¹å¾å·¥ç¨‹å»ºè®®
ä½ è¿˜å¯ä»¥æ„é€ ä¸€ä¸ªæ–°å˜é‡ï¼Œå¦‚ï¼š

```python
df['rate_to_upfront_ratio'] = df['rate_of_interest'] / (df['Upfront_charges'] + 1)
```

ä½œä¸ºä¸€ä¸ªè´·æ¬¾â€œç»¼åˆæˆæœ¬å‹åŠ›â€æŒ‡æ ‡ï¼Œå¯èƒ½æ›´æœ‰åŠ©äºæ¨¡å‹ç†è§£ã€‚

---

### âœ… æ€»ç»“ä¸€ä¸‹ä½ çš„é€‰æ‹©è·¯å¾„ï¼š

| æƒ…å†µ | æ˜¯å¦ä¿ç•™ |
|------|----------|
| ç›®æ ‡æ˜¯å‡†ç¡®ç‡ï¼Œæ¨¡å‹æ˜¯æ ‘æ¨¡å‹/ç¥ç»ç½‘ç»œ | âœ”ï¸ ä¿ç•™ |
| æ¨¡å‹æ˜¯é€»è¾‘å›å½’/è§£é‡Šæ€§è¦æ±‚é«˜ | âš ï¸ ä¿ç•™ä¸€ä¸¤ä¸ªå˜é‡æˆ–åšPCA |
| ä¸‰åˆ—ä¹‹é—´ä¹Ÿå¼ºç›¸å…³ï¼ˆé«˜å…±çº¿ï¼‰ | âš ï¸ å¯å»æ‰æ¨å¯¼åˆ—å¦‚ `Interest_rate_spread` |

---

### Evaluation Metrics
æœ¬é¡¹ç›®é‡‡ç”¨ä»¥ä¸‹äº”é¡¹å¸¸è§çš„åˆ†ç±»æ€§èƒ½æŒ‡æ ‡æ¥å…¨é¢è¯„ä¼°æ¨¡å‹åœ¨è´·æ¬¾è¿çº¦é¢„æµ‹ä»»åŠ¡ä¸­çš„è¡¨ç°ï¼š
####  1. Accuracyï¼ˆå‡†ç¡®ç‡ï¼‰
è¡¨ç¤ºæ¨¡å‹é¢„æµ‹æ­£ç¡®çš„æ ·æœ¬æ•°åœ¨æ€»æ ·æœ¬æ•°ä¸­çš„æ¯”ä¾‹
####  2. Precisionï¼ˆç²¾ç¡®ç‡ï¼‰
è¡¨ç¤ºè¢«æ¨¡å‹é¢„æµ‹ä¸ºâ€œè¿çº¦â€çš„æ ·æœ¬ä¸­ï¼Œå®é™…çœŸçš„è¿çº¦çš„æ¯”ä¾‹ã€‚é€‚åˆå…³æ³¨â€œé¢„æµ‹ä¸ºæ­£â€çš„å‡†ç¡®æ€§åœºæ™¯ã€‚
####  3. Recallï¼ˆå¬å›ç‡ï¼‰/ Sensitivityï¼ˆæ•æ„Ÿåº¦ï¼‰
####  4. F1 Scoreï¼ˆè°ƒå’Œå¹³å‡å€¼ï¼‰
F1 æ˜¯ Precision å’Œ Recall çš„è°ƒå’Œå¹³å‡ï¼Œæ˜¯ä¸€ç§åœ¨ä¸å¹³è¡¡æ•°æ®ä¸­å¸¸ç”¨çš„ç»¼åˆæŒ‡æ ‡ï¼š
F1 Score è¶Šé«˜è¡¨ç¤ºæ¨¡å‹åœ¨ç²¾åº¦å’Œå¬å›ä¹‹é—´è¾¾æˆäº†æ›´å¥½çš„å¹³è¡¡ã€‚
####  5. AUC-ROCï¼ˆArea Under the ROC Curveï¼‰
AUC è¡¡é‡æ¨¡å‹åœ¨å„ç§é˜ˆå€¼ä¸‹å¯¹æ ·æœ¬æ’åºçš„èƒ½åŠ›ï¼Œ
- AUC è¶Šæ¥è¿‘ 1 è¶Šå¥½ï¼›
- AUC = 0.5 è¡¨ç¤ºéšæœºçŒœæµ‹ã€‚

### Results

#### ğŸ”¢ Model Performance Summary

| Model              | Best AUC Score | Best Parameters                                      |
|-------------------|----------------|------------------------------------------------------|
| **LightGBM**       | 0.8981         | `{'num_leaves': 128, 'learning_rate': 0.05, 'max_depth': -1}` |
| **XGBoost**        | 0.8968         | `{'learning_rate': 0.05, 'max_depth': 10, 'n_estimators': 200}` |
| **CatBoost**       | 0.8964         | `{'learning_rate': 0.1, 'depth': 8}`                |
| **MLP**            | 0.8927         | `{'batch_size': 64, 'lr': 0.001, 'epochs': 15}`     |
| **LogisticRegression** | 0.8400         | `{'C': 10.0}`                                        |

> ğŸ”¥ **Best overall model**: **LightGBM** with AUC = **0.8981**

---

#### ğŸ“ˆ Performance Comparison (AUC)

![Best AUC per Model](res/BestAUCperModel.png)

---

#### âš™ï¸ Parameter Tuning Results (AUC by Param Combination)

- **LightGBM**  
  ![LightGBM Param AUC](res/LighGBMParamAUC.png)

- **XGBoost**  
  ![XGBoost Param AUC](res/XGBoostParamAUC.png)

- **CatBoost**  
  ![CatBoost Param AUC](res/CatBoostaParamAUC.png)

- **MLP**  
  ![MLP Param AUC](res/MLPParamAUC.png)

- **Logistic Regression**  
  ![LogReg Param AUC](res/LRegParamAUC.png)

---

#### ğŸ“Š Accuracy vs AUC of All Trials

- **Interactive Hover Plot (Plotly)**  
  ![GIF Interaction](res/fine_tune.gif)

- **Static Comparison Plot**  
  ![All Tuning Accuracy vs AUC](res/FineTuningACAUC.png)

---

#### ğŸ” Top 20 Feature Importances (LightGBM)

![Feature Importance](res/Importance.png)

é‡ç‚¹ç‰¹å¾åŒ…æ‹¬ï¼š
- `LTV`, `income`, `Credit_Score`, `dtir1`, `loan_amount`, `property_value`
- è¿™äº›å˜é‡åœ¨è´·æ¬¾è¿çº¦é£é™©é¢„æµ‹ä¸­å…·æœ‰æ˜¾è‘—çš„è§£é‡ŠåŠ›ã€‚

---


### Work
- æ¨¡å‹å®ç°
- å‰åç«¯å¯è§†åŒ–
- PPT + æ¼”è®²
- Report ï¼ˆåç½®ï¼‰