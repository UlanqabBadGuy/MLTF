# The Group Project - Machine Learning in Trading and Finance
___
Topic: Prediction of Loan Default Risk Based on Machine Learning
___
## Inroduction
data file: data/Loan_Default/Loan_Default.csvï¼ˆhttps://www.kaggle.com/datasets/yasserh/loan-default-dataset/dataï¼‰

## Methodology
### Model selection
åœ¨â€œ**è´·æ¬¾è¿çº¦é£é™©é¢„æµ‹ï¼ˆPrediction of Loan Default Riskï¼‰**â€è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬é¢å¯¹çš„æ˜¯ä¸€ä¸ª**ç»“æ„åŒ–è¡¨æ ¼æ•°æ®ä¸Šçš„äºŒåˆ†ç±»é—®é¢˜**ï¼ˆæ˜¯å¦è¿çº¦ï¼š0 or 1ï¼‰ï¼Œç›®æ ‡æ˜¯**ç²¾å‡†é¢„æµ‹é«˜é£é™©å®¢æˆ·**ã€‚è¿™ç±»é—®é¢˜æ˜¯é‡‘èé£æ§ä¸­çš„ç»å…¸åœºæ™¯ã€‚

---

#### âœ… **æ¨èçš„æ¨¡å‹**

ä»¥ä¸‹æ˜¯ä¸šç•Œã€æ¯”èµ›å’Œç”Ÿäº§ç¯å¢ƒä¸­éƒ½è¡¨ç°ä¼˜ç§€ã€å¸¸ç”¨çš„æ¨¡å‹ï¼š

| æ¨¡å‹åç§°        | ç‰¹ç‚¹                                              | æ˜¯å¦æ¨è |
|-----------------|---------------------------------------------------|----------|
| **LightGBM**     | å¾®è½¯æå‡ºçš„ GBDT ä¼˜åŒ–ç‰ˆï¼Œé€Ÿåº¦å¿«ã€æ€§èƒ½å¼ºã€é€‚åˆå¤§æ•°æ® | â­â­â­â­â­ æ¨è |
| **XGBoost**      | æœ€çŸ¥åçš„ GBDT å®ç°ï¼ŒKaggle æ¯”èµ›å¸¸èƒœå°†å†›           | â­â­â­â­     |
| **CatBoost**     | Yandex æå‡ºçš„ï¼Œå¤©ç„¶æ”¯æŒç±»åˆ«å˜é‡                   | â­â­â­â­     |
| **Logistic Regression** | åŸºçº¿æ¨¡å‹ï¼Œç»“æœå¯è§£é‡Šæ€§å¼ºï¼ˆé‡‘èé¢†åŸŸå¸¸ç”¨ï¼‰    | â­â­â­      |
| **MLPï¼ˆå¤šå±‚æ„ŸçŸ¥æœºï¼‰**   | æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œéœ€å¤§é‡è°ƒå‚ï¼Œé€‚åˆå¤æ‚éçº¿æ€§     | â­â­       |
---

#### **æ¨¡å‹é€‰æ‹©**

| ä¼˜å…ˆé¡ºåº | æ¨¡å‹            | é€‚ç”¨åœºæ™¯                 |
|----------|------------------|--------------------------|
| 1        | LightGBM         | é»˜è®¤é¦–é€‰ï¼Œæ€§èƒ½+é€Ÿåº¦å…¼é¡¾ |
| 2        | XGBoost          | é«˜å¯æ§æ€§ã€æ¯”èµ›å¸¸ç”¨       |
| 3        | CatBoost         | ç±»åˆ«å˜é‡å¤šæ—¶å¾ˆæœ‰ä¼˜åŠ¿     |
| 4        | LogisticRegression | éœ€è¦å¼ºè§£é‡Šæ€§æ—¶ä½¿ç”¨     |
| 5        | MLPï¼ˆç¥ç»ç½‘ç»œï¼‰    | å¤æ‚éçº¿æ€§é—®é¢˜           |

#### æ³¨æ„äº‹é¡¹

æ•°æ®ä¸å¹³è¡¡é—®é¢˜ï¼ˆè¿çº¦å¾€å¾€æ˜¯å°‘æ•°ï¼‰
- æ ‡ç­¾ä¸­ `è¿çº¦ï¼ˆStatus=1ï¼‰` å æ¯”å¾ˆå°‘ï¼š
    - æˆ‘ä»¬ä½¿ç”¨ `class_weight='balanced'` å‚æ•°
---
#### Problems
æ­¤ä¸‰åˆ—ï¼š
1. `rate_of_interest`ï¼ˆè´·æ¬¾åˆ©ç‡ï¼‰  
2. `Interest_rate_spread`ï¼ˆè´·æ¬¾åˆ©ç‡ä¸åŸºå‡†åˆ©ç‡ä¹‹é—´çš„å·®é¢ï¼‰  
3. `Upfront_charges`ï¼ˆè´·æ¬¾å‰æœŸè´¹ç”¨ï¼‰

å’Œç›®æ ‡å˜é‡**é«˜åº¦ç›¸å…³**ã€‚
ç»è¿‡åˆ†æï¼Œæˆ‘ä»¬å‘ç°

| å˜é‡ | ç¼ºå¤±è¡Œä¸º | æ˜¯å¦æ³„éœ² |
|------|---------|-----------|
| `Interest_rate_spread` | **è¿çº¦æ—¶æ€»æ˜¯ NaN**ï¼Œä¸è¿çº¦æ—¶ä»ä¸ NaN | âœ… **å¼ºçƒˆä¿¡æ¯æ³„éœ²** |
| `rate_of_interest` | ç±»ä¼¼äºä¸Šé¢ï¼Œå’Œç›®æ ‡å˜é‡å‡ ä¹åŒæ­¥ç¼ºå¤± | âœ… ä¿¡æ¯æ³„éœ² |
| `Upfront_charges` | åŒæ ·è¡Œä¸º | âœ… ä¿¡æ¯æ³„éœ² |
| `Property_value`, `LTV`, `dtir1` | åœ¨è¿çº¦è´·æ¬¾ä¸­ç¼ºå¤±è¾ƒå¤šï¼Œéè¿çº¦ä¸­å‡ ä¹éƒ½ä¸ç¼º | âš ï¸ å¼±ä¿¡æ¯æ³„éœ² |
è¿™æ­ç¤ºäº†**ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜**ï¼š  
> æ•°æ®é›†ä¸­ï¼ŒæŸäº›å˜é‡çš„â€œç¼ºå¤±å€¼â€**ç›´æ¥æš—ç¤ºäº†ç›®æ ‡å€¼**ï¼Œè¿™å…¶å®æ˜¯ä¸€ç§**ä¿¡æ¯æ³„éœ²çš„å½¢å¼**ã€‚

---

##### é—®é¢˜æ ¸å¿ƒï¼šNaN = isDefaulted çš„ä¿¡å·

ä¾‹å¦‚åªå†™ï¼š

```python
X['missing_spread'] = X['Interest_rate_spread'].isnull()
```
ç„¶åç”¨å®ƒä½œä¸ºç‰¹å¾è®­ç»ƒæ¨¡å‹ï¼Œæ¨¡å‹å°±èƒ½â€œ100%å‡†ç¡®â€åœ°é¢„æµ‹è¿çº¦æƒ…å†µï¼Œå®Œå…¨**ä¸æ˜¯å› ä¸ºç†è§£äº†ä¸šåŠ¡é€»è¾‘**ï¼Œè€Œæ˜¯**åˆ©ç”¨äº†æ ‡ç­¾æœ¬èº«çš„æ³„éœ²çº¿ç´¢**ã€‚

æå‡ºé—®é¢˜ï¼Œé‚£å¦‚æœç›´æ¥å¡«è¡¥ç¼ºå¤±å†è®­ç»ƒï¼Ÿ
ç”¨å¹³å‡å€¼ã€ä¸­ä½æ•°æˆ–è€…å›å½’å¡«è¡¥è¿™äº›ç¼ºå¤±å€¼ä¸å°±å¥½äº†å—

**å…¶å®ä¸è¡Œã€‚**  
å› ä¸ºè¿™ä¸ªç¼ºå¤±ä¸æ˜¯â€œæ­£å¸¸çš„ç¼ºå¤±â€ï¼Œè€Œæ˜¯**æ ‡ç­¾é€ æˆçš„ç¼ºå¤±ï¼ˆTarget-induced Missingnessï¼‰**ï¼Œè¿™ç§ç¼ºå¤±ä¸æ˜¯éšæœºçš„ï¼ˆä¸æ˜¯ Missing At Randomï¼‰ï¼Œè€Œæ˜¯è·Ÿ `loan_default` å¼ºç›¸å…³çš„ï¼ˆç”šè‡³æ˜¯å†³å®šæ€§çš„ï¼‰ã€‚


**è®­ç»ƒæ¨¡å‹æ—¶**ï¼Œåº”å½“åˆ é™¤è¿™å‡ ä¸ªæ³„éœ²å˜é‡ï¼š

| ç‰¹å¾å | æ¨èæ“ä½œ |
|--------|----------|
| `Interest_rate_spread` | âŒ åˆ é™¤ |
| `rate_of_interest` | âŒ åˆ é™¤ |
| `Upfront_charges` | âŒ åˆ é™¤ |


è¿™æ ·åšå¯ä»¥é¿å…æ¨¡å‹â€œåˆ©ç”¨ç¼ºå¤±å½“ç­”æ¡ˆâ€ï¼Œæ›´æ¥è¿‘çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­é¢„æµ‹è¿çº¦çš„èƒ½åŠ›ã€‚

---

### Evaluation Metrics

| Metric               | Meaning                  |
|----------------------|--------------------------|
| **AUC-ROC**          | è¡¡é‡æ¨¡å‹è¯†åˆ«æ­£è´Ÿæ ·æœ¬èƒ½åŠ›             |
| **Precision**        | ç²¾ç¡®ç‡ï¼Œé¢„æµ‹ä¸ºè¿çº¦ä¸­çœŸæ­£è¿çº¦çš„æ¯”ä¾‹        |
| **Recall**           | å¬å›ç‡ï¼Œæ‰€æœ‰è¿çº¦ä¸­è¢«æ¨¡å‹è¯†åˆ«çš„æ¯”ä¾‹        |
| **F1-score**         | Precision å’Œ Recall çš„è°ƒå’Œå¹³å‡ |
| **Confusion Matrix** | çœŸé˜³ã€å‡é˜³ã€çœŸé˜´ã€å‡é˜´çš„å…·ä½“æ•°é‡         |
æœ¬é¡¹ç›®é‡‡ç”¨ä»¥ä¸‹äº”é¡¹å¸¸è§çš„åˆ†ç±»æ€§èƒ½æŒ‡æ ‡æ¥å…¨é¢è¯„ä¼°æ¨¡å‹åœ¨è´·æ¬¾è¿çº¦é¢„æµ‹ä»»åŠ¡ä¸­çš„è¡¨ç°ï¼š
####  1. Accuracyï¼ˆå‡†ç¡®ç‡ï¼‰
è¡¨ç¤ºæ¨¡å‹é¢„æµ‹æ­£ç¡®çš„æ ·æœ¬æ•°åœ¨æ€»æ ·æœ¬æ•°ä¸­çš„æ¯”ä¾‹
####  2. Precisionï¼ˆç²¾ç¡®ç‡ï¼‰
è¡¨ç¤ºè¢«æ¨¡å‹é¢„æµ‹ä¸ºâ€œè¿çº¦â€çš„æ ·æœ¬ä¸­ï¼Œå®é™…çœŸçš„è¿çº¦çš„æ¯”ä¾‹ã€‚é€‚åˆå…³æ³¨â€œé¢„æµ‹ä¸ºæ­£â€çš„å‡†ç¡®æ€§åœºæ™¯ã€‚
####  3. Recallï¼ˆå¬å›ç‡ï¼‰/ Sensitivityï¼ˆæ•æ„Ÿåº¦ï¼‰
####  4. F1 Scoreï¼ˆè°ƒå’Œå¹³å‡å€¼ï¼‰
F1 æ˜¯ Precision å’Œ Recall çš„è°ƒå’Œå¹³å‡ï¼Œæ˜¯ä¸€ç§åœ¨ä¸å¹³è¡¡æ•°æ®ä¸­å¸¸ç”¨çš„ç»¼åˆæŒ‡æ ‡ï¼š
F1 Score è¶Šé«˜è¡¨ç¤ºæ¨¡å‹åœ¨ç²¾åº¦å’Œå¬å›ä¹‹é—´è¾¾æˆäº†æ›´å¥½çš„å¹³è¡¡ã€‚
####  5. AUC-ROCï¼ˆArea Under the ROC Curveï¼‰
AUC è¡¡é‡æ¨¡å‹åœ¨å„ç§é˜ˆå€¼ä¸‹å¯¹æ ·æœ¬æ’åºçš„èƒ½åŠ›ï¼Œ
- AUC è¶Šæ¥è¿‘ 1 è¶Šå¥½ï¼›
- AUC = 0.5 è¡¨ç¤ºéšæœºçŒœæµ‹ã€‚

### Results

#### ğŸ”¢ Model Performance Summary

| Model              | Best AUC Score | Best Parameters                                      |
|-------------------|----------------|------------------------------------------------------|
| **LightGBM**       | 0.8981         | `{'num_leaves': 128, 'learning_rate': 0.05, 'max_depth': -1}` |
| **XGBoost**        | 0.8968         | `{'learning_rate': 0.05, 'max_depth': 10, 'n_estimators': 200}` |
| **CatBoost**       | 0.8964         | `{'learning_rate': 0.1, 'depth': 8}`                |
| **MLP**            | 0.8927         | `{'batch_size': 64, 'lr': 0.001, 'epochs': 15}`     |
| **LogisticRegression** | 0.8400         | `{'C': 10.0}`                                        |

> ğŸ”¥ **Best overall model**: **LightGBM** with AUC = **0.8981**

---

#### ğŸ“ˆ Performance Comparison (AUC)

![Best AUC per Model](res/BestAUCperModel.png)

---

#### âš™ï¸ Parameter Tuning Results (AUC by Param Combination)

- **LightGBM**  
  ![LightGBM Param AUC](res/LighGBMParamAUC.png)

- **XGBoost**  
  ![XGBoost Param AUC](res/XGBoostParamAUC.png)

- **CatBoost**  
  ![CatBoost Param AUC](res/CatBoostaParamAUC.png)

- **MLP**  
  ![MLP Param AUC](res/MLPParamAUC.png)

- **Logistic Regression**  
  ![LogReg Param AUC](res/LRegParamAUC.png)

---

#### ğŸ“Š Accuracy vs AUC of All Trials

- **Interactive Hover Plot (Plotly)**  
  ![GIF Interaction](res/fine_tune.gif)

- **Static Comparison Plot**  
  ![All Tuning Accuracy vs AUC](res/FineTuningACAUC.png)

---

#### ğŸ” Top 20 Feature Importances (LightGBM)

![Feature Importance](res/Importance.png)

é‡ç‚¹ç‰¹å¾åŒ…æ‹¬ï¼š
- `LTV`, `income`, `Credit_Score`, `dtir1`, `loan_amount`, `property_value`
- è¿™äº›å˜é‡åœ¨è´·æ¬¾è¿çº¦é£é™©é¢„æµ‹ä¸­å…·æœ‰æ˜¾è‘—çš„è§£é‡ŠåŠ›ã€‚

---